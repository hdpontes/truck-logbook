version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: truck-backend
    environment:
      - NODE_ENV=production
      - PORT=4000
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - JWT_SECRET=${JWT_SECRET}
      - N8N_WEBHOOK_URL=${N8N_WEBHOOK_URL}
      - CORS_ORIGIN=${CORS_ORIGIN}
    ports:
      - "${BACKEND_PORT:-8100}:4000"      
    networks:
      - automacoes_default
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.truck-api.rule=Host(`truck-api.hpboost.com.br`)"
      - "traefik.http.routers.truck-api.entrypoints=websecure"
      - "traefik.http.routers.truck-api.tls.certresolver=letsencrypt"
      - "traefik.http.services.truck-api.loadbalancer.server.port=4000"

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: truck-frontend
    networks:
      - automacoes_default
      - backend-network
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.truck-frontend.rule=Host(`truck.hpboost.com.br`)"
      - "traefik.http.routers.truck-frontend.entrypoints=websecure"
      - "traefik.http.routers.truck-frontend.tls.certresolver=letsencrypt"
      - "traefik.http.services.truck-frontend.loadbalancer.server.port=80"

networks:
  backend-network:
    driver: bridge



