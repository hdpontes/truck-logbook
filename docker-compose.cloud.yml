version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: truck-backend
    environment:
      NODE_ENV: production
      PORT: 4000
      DATABASE_URL: ${DATABASE_URL}
      JWT_SECRET: ${JWT_SECRET}
      CORS_ORIGIN: https://truck.hpboost.com.br
    networks:
      - backend-network
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.truck-api.rule=Host(`truck-api.hpboost.com.br`)"
      - "traefik.http.routers.truck-api.entrypoints=websecure"
      - "traefik.http.routers.truck-api.tls.certresolver=letsencrypt"
      - "traefik.http.services.truck-api.loadbalancer.server.port=4000"

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: truck-frontend
    networks:
      - backend-network
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.truck-frontend.rule=Host(`truck.hpboost.com.br`)"
      - "traefik.http.routers.truck-frontend.entrypoints=websecure"
      - "traefik.http.routers.truck-frontend.tls.certresolver=letsencrypt"
      - "traefik.http.services.truck-frontend.loadbalancer.server.port=80"

networks:
  backend-network:
    driver: bridge


